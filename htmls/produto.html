<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produto | Joalheria Lumière</title>
    <link rel="stylesheet" href="../css/produto.css" />
  </head>
  <body>
    <header class="header-produto">
      <div class="logo-produto">
        <img src="../imagens/icons/icon-diamante.png" alt="Logo" width="32" />
        <h1>Joalheria Lumière</h1>
      </div>
    </header>
    <main>
      <section class="produto-detalhe" id="produto-detalhe"></section>
      <section class="produtos-relacionados" id="produtos-relacionados">
        <h2>Produtos Relacionados</h2>
        <div class="relacionados-grid"></div>
      </section>
    </main>
    <footer class="footer-produto">
      <p>&copy; 2025 Joalheria Lumière. Todos os direitos reservados.</p>
    </footer>
    <script>
      function getIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get("id");
      }
      function whatsappButton(produto) {
        const msg = encodeURIComponent(
          `Olá! Tenho interesse no produto "${produto.nome}".`
        );
        return `<a class="btn-whatsapp" href="https://wa.me/5511123456789?text=${msg}" target="_blank">Fale pelo WhatsApp</a>`;
      }
      function montarProduto(produto) {
        return `
        <div class="produto-box">
          <img src="${produto.imagem}" alt="${
          produto.nome
        }" class="produto-img">
          <div class="produto-info">
            <h2 class="produto-nome">${produto.nome}</h2>
            <span class="produto-preco">R$ ${produto.preco}</span>
            <p class="produto-descricao">${produto.descricao}</p>
            <p class="produto-material"><strong>Material:</strong> ${
              produto.material
            }</p>
            ${whatsappButton(produto)}
          </div>
        </div>
      `;
      }
      function montarRelacionados(produtos, idAtual) {
        const outros = produtos.filter((p) => String(p.id) !== String(idAtual));
        const embaralhados = outros.sort(() => Math.random() - 0.5).slice(0, 4);
        return embaralhados
          .map(
            (prod) => `
        <a href="produto.html?id=${prod.id}" class="relacionado-card">
          <img src="${prod.imagem}" alt="${prod.nome}">
          <span>${prod.nome}</span>
          <span class="relacionado-preco">R$ ${prod.preco}</span>
        </a>
      `
          )
          .join("");
      }
      const id = getIdFromUrl();
      fetch("../javascript/produtos.json")
        .then((res) => res.json())
        .then((produtos) => {
          const produto = produtos.find((p) => String(p.id) === String(id));
          const detalhe = document.getElementById("produto-detalhe");
          if (produto) {
            detalhe.innerHTML = montarProduto(produto);
            document.querySelector(".relacionados-grid").innerHTML =
              montarRelacionados(produtos, produto.id);
          } else {
            detalhe.innerHTML = `<div class="produto-nao-encontrado">Produto não encontrado.</div>`;
            document.querySelector(".relacionados-grid").innerHTML = "";
          }
        })
        .catch(() => {
          document.getElementById("produto-detalhe").innerHTML =
            '<div class="produto-nao-encontrado">Erro ao carregar produtos.</div>';
        });
    </script>
  </body>
</html>
